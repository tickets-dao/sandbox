#!/bin/sh

. default

while true
do
    _setup_extra_packages
    
    md5sum -c "$STATE_HASH" 2>&1 >/dev/null || break

    find "$DATA" ! -name "backup.tar.gz" > "$STATE_FILE_TMP"
    if ! _equal "$STATE_FILE_TMP" "$STATE_FILE"
    then
        diff "$STATE_FILE_TMP" "$STATE_FILE"
        mv -v "$STATE_FILE_TMP" "$STATE_FILE"
        break
    fi
    
    sleep "$SLEEP_STATE"
done
